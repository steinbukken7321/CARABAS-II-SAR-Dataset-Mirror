# -*- coding: utf-8 -*-
"""Carabas_Images-Reading_exemple.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zKfGraQMLsPv9Un1GsL-Oto8WqP9_8Ex
"""

import os
import cv2

def manage_and_load_carabas_data(data_path):
    """
    Verifica a existência do diretório e o cria se necessário.
    Carrega as imagens do CARABAS-II sem realizar alterações nos dados brutos.
    """

    # 1. Verificação e Criação do Diretório
    if not os.path.exists(data_path):
        print(f"Diretório {data_path} não encontrado. Criando diretório...")
        os.makedirs(data_path)
        # Se acabou de ser criado, o diretório está vazio
        print("Diretório criado com sucesso.")
        return []

    # 2. Listagem de arquivos na pasta
    # Filtro apenas para garantir que estamos tentando ler arquivos de imagem
    valid_extensions = ('.png', '.jpg', '.jpeg', '.tif', '.bmp', '.mat')
    all_files = os.listdir(data_path)
    image_files = [f for f in all_files if f.lower().endswith(valid_extensions)]

    if len(image_files) == 0:
        print(f"O diretório {data_path} existe, mas não contém imagens válidas.")
        return []

    print(f"Iniciando leitura de {len(image_files)} arquivos do CARABAS-II...")

    raw_data_list = []

    # 3. Carregamento dos dados brutos
    for filename in image_files:
        full_path = os.path.join(data_path, filename)

        # Leitura da imagem mantendo os bits originais (sem conversão automática)
        # IMREAD_UNCHANGED garante que imagens de radar de 16-bits ou com múltiplos canais
        # não sejam alteradas para 8-bits/RGB acidentalmente.
        img = cv2.imread(full_path, cv2.IMREAD_UNCHANGED)

        # Verificação manual de integridade do arquivo carregado
        if img is None:
            print(f"Erro na leitura do arquivo: {filename}. Verifique o formato.")
            continue

        # Adiciona a imagem bruta à lista
        raw_data_list.append(img)

    print(f"Leitura concluída. Total de objetos carregados: {len(raw_data_list)}")
    return raw_data_list

# Definição do Caminho
# Caminho para a pasta data-samples no repositório do dataset
PATH_TO_DATA = "../CARABAS-II-SAR-Dataset-Mirror/img"

# Execução do carregamento
carabas_images = manage_and_load_carabas_data(PATH_TO_DATA)